@import "vendor/rfs";

@mixin parameter { @content; }

{{ with .Scratch.Get "plugin-toc.Parameters" }}

/// Variables
$toc-width: {{ .Style.Variables.TOCWidth }}px;
$level-indent: {{ .Style.Variables.LevelIndent }};
$backdrop-opacity: {{ .Style.Variables.BackdropOpacity }};

#{{ .Specifiers.BackdropID }} {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  {{ with .Style.Backdrop }}@include parameter { {{ template "wrap-content" . }} }{{ end }}

  // Fade backdrop and lower to prevent click handling.
  &.{{ .Specifiers.FadeClassName }} { 
    opacity: 0; 
    z-index: -1;
  }
  
  // Show and raise to allow click handling.
  &.{{ .Specifiers.ShowClassName }} { 
    opacity: $backdrop-opacity; 
    z-index: 1040;
  }
}

span.{{ .Specifiers.InjectedSectionNumberClassName }} {
 {{ with .Style.SectionNumber }}@include parameter { {{ template "wrap-content" . }} }{{ end }} 
}

button#{{ .Specifiers.ToggleID }} {
  border: none;
  border-radius: 0;
  white-space: nowrap;
  {{ with .Style.Toggle }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
}

#{{ .Specifiers.ContainerID }} {
  top: 0;
  left: 0;
  bottom: 0;
  width: $toc-width;
  max-width: 100%;
  position: fixed;
  display: flex;
  flex-direction: column;
  background-clip: padding-box;
  outline: 0;
  {{ with .Style.TOC }}@include parameter { {{ template "wrap-content" . }} }{{ end }}

  &.{{ .Specifiers.OffscreenClassName }} {
    z-index: 1045;
    transform: translateX(-100%);
    transition: transform .3s ease-in-out;
    
    &.{{ .Specifiers.ShowClassName }} { transform: none; }
    
  }
  
  header#{{ .Specifiers.HeaderID }} {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    {{ with .Style.Header }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
    
    h2#{{ .Specifiers.TitleID }} {
      {{ with .Style.Title }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
    }
    
    button#{{ .Specifiers.CloseButtonID }} {
      position: absolute;      
      padding: 0;
      margin: 0;
      background: transparent;
      border: none;
      visibility: hidden;
      {{ with .Style.CloseButton }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
      
      @media (max-width: $toc-width + 50) {
        visibility: visible;
      }
      
      svg {
        display: inline-block;
        height: 1rem;
        overflow: visible;
        align-self: center;
        vertical-align: center;
        fill: currentcolor;
      }
      
    } // button#.Specifiers.CloseButtonID

  } // header#.Specifiers.HeaderID
  
  nav#{{ .Specifiers.BodyID }} {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column; 
    {{ with .Style.Body }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
    
    .{{ .Specifiers.TOCEntryClassName }} {
        display: flex;
        align-items: baseline;
        {{ with .Style.Entry }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
      
        &.{{ .Specifiers.LevelClassNamePrefix }}2 {
          @include margin-left($level-indent * 1);
        }
        &.{{ .Specifiers.LevelClassNamePrefix }}3 {
          @include margin-left($level-indent * 2);
        }
        &.{{ .Specifiers.LevelClassNamePrefix }}4 {
          @include margin-left($level-indent * 3);
        }
        &.{{ .Specifiers.LevelClassNamePrefix }}5 {
          @include margin-left($level-indent * 4);
        }
    
        .{{ .Specifiers.SectionNumberClassName }} {
          {{ with .Style.EntrySection }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
        }
      
        a {
          {{ with .Style.EntryLink }}@include parameter { {{ template "wrap-content" . }} }{{ end }}
        }
      
    } // .Specifiers.TOCEntryClassName
    
  } // nav#.Specifiers.BodyID
  
} // #.Specifiers.ContainerID

{{ end }}

{{ define "wrap-content" }}
{{ $pattern := `(font-size|padding|padding-top|padding-right|padding-bottom|padding-left|margin|margin-top|margin-right|margin-bottom|margin-left):\w*([^;]+)` }}
{{ $replacement := `@include $1($2)` }}
{{ replaceRE $pattern $replacement . }}
{{ end }}